name: Coverity Scan - frontend

on:
  push:
    branches: [ master ]
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  coverity-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install frontend dependencies
        run: |
          cd frontend
          npm install

      # Build + Coverity capture + upload (vapier action does the heavy lifting)
      - name: Run Coverity Scan action (build & upload)
        uses: vapier/coverity-scan-action@v1
        with:
          # leave project blank to default to the GitHub repo name (owner/repo),
          # or set explicitly to the exact project name on scan.coverity.com (case-sensitive)
          project: 'ShopEase - Frontend' 
          token: ${{ secrets.COVERITY_SCAN_FRONTEND_TOKEN }}
          email: ${{ secrets.COVERITY_SCAN_EMAIL }}
          build_language: 'javascript'    # javascript / nodejs
          build_platform: 'linux64'
          # the command wrapped by cov-build; use the production build so bundler work gets captured
          command: "cd frontend && npm run build"
          # optional: increase timeout if your build is large (in minutes)
          # timeout: 60
